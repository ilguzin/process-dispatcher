<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Class: ModuleProcess</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Class: ModuleProcess</h1>

    




<section>

<header>
    
        <h2><span class="attribs"><span class="type-signature"></span></span>ModuleProcess<span class="signature">(moduleName, moduleOpts)</span><span class="type-signature"></span></h2>
        
            <div class="class-description"><p>ModuleProcess</p>

<p>A wrapper for module to make it running its functionality within subprocess accepting IPC messages
as commands.</p>

<p>The main purpose of the <a href="ModuleProcess.html">ModuleProcess</a> is to invoke within subprocess any module function by name
(available via module.exports of wrapped module) passing parameters to it (see ModuleProcess.invoke
for details). The function name to call and parameters are accepted via IPC, the callback invoked then on IPC
chanel in form of message back to parent.</p></div>
        
    
</header>

<article>
    <div class="container-overview">
    
        

    
    <h2>Constructor</h2>
    

    
    <h4 class="name" id="ModuleProcess"><span class="type-signature"></span>new ModuleProcess<span class="signature">(moduleName, moduleOpts)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Construct
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>moduleName</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">Module name (script file name). E.g. __filename</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>moduleOpts</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">Options object to pass to the module</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="moduleProcess.js.html">moduleProcess.js</a>, <a href="moduleProcess.js.html#line31">line 31</a>
    </li></ul></dd>
    

    

    

    
</dl>


















    
    </div>

    

    

    

    

    

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id=".listenIPCMessages"><span class="type-signature">(static) </span>listenIPCMessages<span class="signature">(moduleFn, moduleFileName, logger)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Create listener to catch the IPC messages within the process the module is running in.</p>

<p><i>Important: The module should be running within process otherwise registering listener makes no sense.
This will invoke process.on('message', function() {}) to listen for parent process commands.</i></p>

<p>Use <a href="ProcessDispatcher.html">ProcessDispatcher</a> to manage module processes.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>moduleFn</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            

            

            <td class="description last">Module function exposing the API for ProcessDispatcher.dispatch calls.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>moduleFileName</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">File name (whole patch with file name) of the module defined by module function.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>logger</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="moduleProcess.js.html">moduleProcess.js</a>, <a href="moduleProcess.js.html#line71">line 71</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id=".makeCommandId"><span class="type-signature">(static) </span>makeCommandId<span class="signature">(command)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Make unique command token to use in send/receive model to distinguish calls for the child process.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>command</code></td>
            

            <td class="type">
            
                
<span class="param-type">COMMANDS</span>


            
            </td>

            

            

            <td class="description last">A COMMANDS definition for possible commands.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="moduleProcess.js.html">moduleProcess.js</a>, <a href="moduleProcess.js.html#line156">line 156</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    Token
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="addCallback"><span class="type-signature"></span>addCallback<span class="signature">(commandId, callback)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Bind callback to unique command id (or token) to be called once function finished.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>commandId</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">Unique string Token. See. <a href="ModuleProcess.html#.makeCommandId">ModuleProcess.makeCommandId</a></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="ModuleProcess.html#~onReadyCallback">ModuleProcess~onReadyCallback</a></span>


            
            </td>

            

            

            <td class="description last">Callback to run on function finished.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="moduleProcess.js.html">moduleProcess.js</a>, <a href="moduleProcess.js.html#line166">line 166</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id="getCallback"><span class="type-signature"></span>getCallback<span class="signature">(commandId)</span><span class="type-signature"> &rarr; {ModuleProcess~onInvokeCallback}</span></h4>
    

    



<div class="description">
    <p>Get callback by token. See. ModuleProcess.addCallback, <a href="ModuleProcess.html#.makeCommandId">ModuleProcess.makeCommandId</a>.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>commandId</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">Unique string token. See. <a href="ModuleProcess.html#.makeCommandId">ModuleProcess.makeCommandId</a>.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="moduleProcess.js.html">moduleProcess.js</a>, <a href="moduleProcess.js.html#line185">line 185</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    callback   Callback function that has been stored for this commandId.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">ModuleProcess~onInvokeCallback</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="init"><span class="type-signature"></span>init<span class="signature">(callback)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Initialize child process and incoming commands listener.</p>

<p>This will do the following steps:

<ul>
  <li>- Prepare options to be passed for module (functionality options) and process (environment mostly) initialization</li>
  <li>- Fork new subprocess from moduleName</li>
  <li>- Start listening incoming IPC messages from forked sub-process to current process:
    <ul>
      <li>- <i>init command response</i>: will invoke the ModuleProcess.init function callback, notifying
      the module has been initialized in subprocess</li>
      <li>- <i>other command response</i>: will invoke a callback registered with addCallback on incoming
      command call via ModuleProcess.invoke.</li>
    </ul>
  </li>
</ul>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="ModuleProcess.html#~onReadyCallback">ModuleProcess~onReadyCallback</a></span>


            
            </td>

            

            

            <td class="description last">Callback to run on initialization has finished.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="moduleProcess.js.html">moduleProcess.js</a>, <a href="moduleProcess.js.html#line209">line 209</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id="invoke"><span class="type-signature"></span>invoke<span class="signature">(functionName, params)</span><span class="type-signature"> &rarr; {<a href="ModuleProcess.html#~onReadyCallback">ModuleProcess~onReadyCallback</a>}</span></h4>
    

    



<div class="description">
    <p>Request a functionName to be called within subprocess with supplied parameters.
This call return a callback-style function wrapping the invoked function. See invokeExample.js below.</p>

<p>Behind the scenes...</p>

<p>The function invocation workflow is based on the following:</p>

<p>1. On <a href="ModuleProcess.html">ModuleProcess</a> init the module is wrapped by subprocess. Since that the <a href="ModuleProcess.html">ModuleProcess</a> object
 API contains module members that are exposed via <a href="ProcessDispatcher.html#.listenIPCMessages">ProcessDispatcher.listenIPCMessages</a>.
 First parameter in <a href="ProcessDispatcher.html#.listenIPCMessages">ProcessDispatcher.listenIPCMessages</a> is 'moduleFn' (function(moduleOpts) { ... }).
 moduleOpts is used eventually as 'moduleOpts' parameter for that function.
 Then the functionName passed to the ModuleProcess.invoke is one of that functions installed via
 <a href="ProcessDispatcher.html#.listenIPCMessages">ProcessDispatcher.listenIPCMessages</a> invocation.</p>

 <p>2. Once functionName invocation requested the callback is registered for that particular function call (i.e.
 unique token created for the function call)</p>

 <p>3. Later under the hood the callback will be called when the subprocess that wraps the module will respond via
 IPC message to its parent process. The response will be caught by <a href="ModuleProcess.html">ModuleProcess</a> functionality.
 To understand that see how initialization goes in ModuleProcess.init, the
 "case COMMANDS.MODULE_PROCESS_COMMAND_INVOKE" block is what catching command result responses and calling callback
 that is registered when ModuleProcess.invoke has been called.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>functionName</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Function name to be invoked. It is a wrapped module module.export member.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>params</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">Params to be passed to function.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="moduleProcess.js.html">moduleProcess.js</a>, <a href="moduleProcess.js.html#line326">line 326</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    A callback function to be run on command invocation has finished.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="ModuleProcess.html#~onReadyCallback">ModuleProcess~onReadyCallback</a></span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
        <p class="code-caption">invokeExample.js</p>
    
    <pre class="prettyprint"><code>let modProc = ...; // modProc is instance of ModuleProcess
modProc.invoke('foo', {param1: "test"})(function(error, result) {
  console.log("result is ", result);
});</code></pre>



        
            

    

    
    <h4 class="name" id="removeCallback"><span class="type-signature"></span>removeCallback<span class="signature">(commandId)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Unbind callback from Token. See. ModuleProcess.addCallback.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>commandId</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">Unique string token. See. <a href="ModuleProcess.html#.makeCommandId">ModuleProcess.makeCommandId</a></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="moduleProcess.js.html">moduleProcess.js</a>, <a href="moduleProcess.js.html#line175">line 175</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
    

    
        <h3 class="subsection-title">Type Definitions</h3>

        
                

    

    
    <h4 class="name" id="~onReadyCallback"><span class="type-signature"></span>onReadyCallback<span class="signature">(error)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Callback to run on function finished. <i>Note: It might contain arbitrary number of arguments (required at
least one - error)</i></p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>error</code></td>
            

            <td class="type">
            
                
<span class="param-type">Error</span>


            
            </td>

            

            

            <td class="description last">An Error object if the callback has raised an error.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="moduleProcess.js.html">moduleProcess.js</a>, <a href="moduleProcess.js.html#line33">line 33</a>
    </li></ul></dd>
    

    

    

    
</dl>


















            
    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ModuleProcess.html">ModuleProcess</a></li><li><a href="ProcessDispatcher.html">ProcessDispatcher</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Initialize">Initialize</a></li><li><a href="global.html#Invoke">Invoke</a></li><li><a href="global.html#range">range</a></li><li><a href="global.html#Set">Set</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Sep 26 2017 00:19:10 GMT+0300 (MSK)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>